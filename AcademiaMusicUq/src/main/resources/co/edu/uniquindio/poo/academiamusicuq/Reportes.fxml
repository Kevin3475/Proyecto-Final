<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.*?>
<?import javafx.scene.chart.PieChart?>
<?import javafx.scene.chart.BarChart?>
<?import javafx.scene.chart.LineChart?>
<?import javafx.scene.chart.CategoryAxis?>
<?import javafx.scene.chart.NumberAxis?>

<AnchorPane prefHeight="800.0" prefWidth="1200.0" styleClass="dashboard-container"
            xmlns="http://javafx.com/javafx/8"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="co.edu.uniquindio.poo.academiamusicuq.viewController.ReportesViewController">

    <children>
        <VBox prefHeight="800.0" prefWidth="1200.0">
            <!-- Header -->
            <HBox alignment="CENTER_LEFT" style="-fx-background-color: #2980b9; -fx-padding: 15;">
                <children>
                    <Button fx:id="btnVolver" mnemonicParsing="false" onAction="#onVolver" text="â¬… Volver al MenÃº" styleClass="secondary-button">
                        <HBox.margin>
                            <Insets right="20.0" />
                        </HBox.margin>
                    </Button>
                    <Label text="ðŸ“Š MÃ³dulo de Reportes Avanzados" style="-fx-text-fill: white; -fx-font-size: 20; -fx-font-weight: bold;"/>
                </children>
            </HBox>

            <!-- Contenido principal con pestaÃ±as -->
            <TabPane fx:id="tabPaneReportes" tabClosingPolicy="UNAVAILABLE" VBox.vgrow="ALWAYS">
                <tabs>
                    <!-- PESTAÃ‘A 1: REPORTES AVANZADOS -->
                    <Tab text="ðŸ“ˆ Reportes Avanzados">
                        <content>
                            <VBox styleClass="content-area" spacing="20.0">
                                <VBox.margin>
                                    <Insets top="20.0" />
                                </VBox.margin>

                                <Label text="GeneraciÃ³n de Reportes Avanzados" styleClass="section-title">
                                    <VBox.margin>
                                        <Insets left="20.0" />
                                    </VBox.margin>
                                </Label>

                                <!-- Filtros Avanzados -->
                                <VBox styleClass="form-container" spacing="15.0">
                                    <VBox.margin>
                                        <Insets left="20.0" right="20.0" />
                                    </VBox.margin>

                                    <Label text="ðŸ” Filtros del Reporte" style="-fx-font-weight: bold; -fx-font-size: 16;"/>

                                    <GridPane hgap="15.0" vgap="15.0">
                                        <columnConstraints>
                                            <ColumnConstraints hgrow="SOMETIMES" minWidth="10.0" prefWidth="150.0" />
                                            <ColumnConstraints hgrow="SOMETIMES" minWidth="10.0" prefWidth="200.0" />
                                            <ColumnConstraints hgrow="SOMETIMES" minWidth="10.0" prefWidth="150.0" />
                                            <ColumnConstraints hgrow="SOMETIMES" minWidth="10.0" prefWidth="200.0" />
                                            <ColumnConstraints hgrow="SOMETIMES" minWidth="10.0" prefWidth="150.0" />
                                        </columnConstraints>
                                        <rowConstraints>
                                            <RowConstraints minHeight="10.0" prefHeight="30.0" vgrow="SOMETIMES" />
                                            <RowConstraints minHeight="10.0" prefHeight="30.0" vgrow="SOMETIMES" />
                                        </rowConstraints>
                                        <children>
                                            <!-- Fila 1 -->
                                            <Label text="Tipo Reporte:" styleClass="form-label" GridPane.rowIndex="0" GridPane.columnIndex="0"/>
                                            <ComboBox fx:id="cbTipoReporteAvanzado" styleClass="form-field" GridPane.rowIndex="0" GridPane.columnIndex="1"/>

                                            <Label text="Estudiante:" styleClass="form-label" GridPane.rowIndex="0" GridPane.columnIndex="2"/>
                                            <ComboBox fx:id="cbEstudianteReporte" styleClass="form-field" GridPane.rowIndex="0" GridPane.columnIndex="3"/>

                                            <Label text="Fecha Inicio:" styleClass="form-label" GridPane.rowIndex="0" GridPane.columnIndex="4"/>
                                            <DatePicker fx:id="dpFechaInicioReporte" styleClass="form-field" GridPane.rowIndex="0" GridPane.columnIndex="5"/>

                                            <!-- Fila 2 -->
                                            <Label text="Curso:" styleClass="form-label" GridPane.rowIndex="1" GridPane.columnIndex="0"/>
                                            <ComboBox fx:id="cbCursoReporte" styleClass="form-field" GridPane.rowIndex="1" GridPane.columnIndex="1"/>

                                            <Label text="Profesor:" styleClass="form-label" GridPane.rowIndex="1" GridPane.columnIndex="2"/>
                                            <ComboBox fx:id="cbProfesorReporte" styleClass="form-field" GridPane.rowIndex="1" GridPane.columnIndex="3"/>

                                            <Label text="Fecha Fin:" styleClass="form-label" GridPane.rowIndex="1" GridPane.columnIndex="4"/>
                                            <DatePicker fx:id="dpFechaFinReporte" styleClass="form-field" GridPane.rowIndex="1" GridPane.columnIndex="5"/>

                                            <!-- Botones -->
                                            <Button fx:id="btnGenerarReporte" mnemonicParsing="false" onAction="#onGenerarReporte" text="ðŸš€ Generar Reporte" styleClass="primary-button" GridPane.rowIndex="1" GridPane.columnIndex="6"/>
                                        </children>
                                    </GridPane>

                                    <!-- Botones de ExportaciÃ³n -->
                                    <HBox alignment="CENTER" spacing="15.0">
                                        <Button fx:id="btnExportarPDF" mnemonicParsing="false" onAction="#onExportarPDF" text="ðŸ“„ Exportar PDF" styleClass="secondary-button"/>
                                        <Button fx:id="btnExportarExcel" mnemonicParsing="false" onAction="#onExportarExcel" text="ðŸ“Š Exportar Excel" styleClass="secondary-button"/>
                                    </HBox>
                                </VBox>

                                <!-- Tabla de Resultados -->
                                <Label text="Resultados del Reporte" styleClass="section-subtitle">
                                    <VBox.margin>
                                        <Insets left="20.0" />
                                    </VBox.margin>
                                </Label>

                                <TabPane tabClosingPolicy="UNAVAILABLE" VBox.vgrow="ALWAYS">
                                    <tabs>
                                        <Tab text="ðŸ“ˆ Reportes de Progreso">
                                            <TableView fx:id="tblReportesProgreso" VBox.vgrow="ALWAYS">
                                                <columns>
                                                    <TableColumn fx:id="colIdReporte" prefWidth="80.0" text="ID" />
                                                    <TableColumn fx:id="colEstudiante" prefWidth="150.0" text="Estudiante" />
                                                    <TableColumn fx:id="colCurso" prefWidth="150.0" text="Curso" />
                                                    <TableColumn fx:id="colProfesor" prefWidth="150.0" text="Profesor" />
                                                    <TableColumn fx:id="colCalificacion" prefWidth="100.0" text="CalificaciÃ³n" />
                                                    <TableColumn fx:id="colAprobado" prefWidth="100.0" text="Aprobado" />
                                                    <TableColumn fx:id="colFecha" prefWidth="120.0" text="Fecha" />
                                                </columns>
                                            </TableView>
                                        </Tab>
                                        <Tab text="âœ… Asistencias">
                                            <TableView fx:id="tblReportesAsistencia" VBox.vgrow="ALWAYS">
                                                <columns>
                                                    <TableColumn fx:id="colIdAsistencia" prefWidth="80.0" text="ID" />
                                                    <TableColumn fx:id="colEstudianteAsistencia" prefWidth="150.0" text="Estudiante" />
                                                    <TableColumn fx:id="colClaseAsistencia" prefWidth="150.0" text="Clase" />
                                                    <TableColumn fx:id="colFechaAsistencia" prefWidth="120.0" text="Fecha" />
                                                    <TableColumn fx:id="colPresente" prefWidth="100.0" text="Presente" />
                                                </columns>
                                            </TableView>
                                        </Tab>
                                        <Tab text="ðŸ“‹ MatrÃ­culas">
                                            <TableView fx:id="tblReportesMatriculas" VBox.vgrow="ALWAYS">
                                                <columns>
                                                    <TableColumn fx:id="colIdMatricula" prefWidth="80.0" text="ID" />
                                                    <TableColumn fx:id="colEstudianteMatricula" prefWidth="150.0" text="Estudiante" />
                                                    <TableColumn fx:id="colCursoMatricula" prefWidth="150.0" text="Curso" />
                                                    <TableColumn fx:id="colEstadoMatricula" prefWidth="120.0" text="Estado" />
                                                    <TableColumn fx:id="colFechaMatricula" prefWidth="120.0" text="Fecha" />
                                                </columns>
                                            </TableView>
                                        </Tab>
                                    </tabs>
                                </TabPane>
                            </VBox>
                        </content>
                    </Tab>

                    <!-- PESTAÃ‘A 2: ESTADÃSTICAS DETALLADAS -->
                    <Tab text="ðŸ“Š EstadÃ­sticas Detalladas">
                        <content>
                            <VBox styleClass="content-area" spacing="20.0">
                                <VBox.margin>
                                    <Insets top="20.0" />
                                </VBox.margin>

                                <Label text="EstadÃ­sticas y MÃ©tricas del Sistema" styleClass="section-title">
                                    <VBox.margin>
                                        <Insets left="20.0" />
                                    </VBox.margin>
                                </Label>

                                <!-- MÃ©tricas Principales -->
                                <VBox styleClass="form-container" spacing="15.0">
                                    <VBox.margin>
                                        <Insets left="20.0" right="20.0" />
                                    </VBox.margin>

                                    <Label text="ðŸ“ˆ MÃ©tricas Principales" style="-fx-font-weight: bold; -fx-font-size: 16;"/>

                                    <GridPane hgap="20.0" vgap="15.0">
                                        <columnConstraints>
                                            <ColumnConstraints hgrow="SOMETIMES" minWidth="10.0" prefWidth="200.0" />
                                            <ColumnConstraints hgrow="SOMETIMES" minWidth="10.0" prefWidth="200.0" />
                                            <ColumnConstraints hgrow="SOMETIMES" minWidth="10.0" prefWidth="200.0" />
                                            <ColumnConstraints hgrow="SOMETIMES" minWidth="10.0" prefWidth="200.0" />
                                        </columnConstraints>
                                        <rowConstraints>
                                            <RowConstraints minHeight="10.0" prefHeight="30.0" vgrow="SOMETIMES" />
                                            <RowConstraints minHeight="10.0" prefHeight="30.0" vgrow="SOMETIMES" />
                                        </rowConstraints>
                                        <children>
                                            <!-- Fila 1 -->
                                            <VBox alignment="CENTER" spacing="5.0" style="-fx-background-color: #3498db; -fx-background-radius: 10; -fx-padding: 15;">
                                                <children>
                                                    <Label text="ðŸ‘¥" style="-fx-font-size: 24;"/>
                                                    <Label text="Total Estudiantes" style="-fx-text-fill: white; -fx-font-weight: bold;"/>
                                                    <Label fx:id="lblTotalEstudiantes" text="0" style="-fx-text-fill: white; -fx-font-size: 18; -fx-font-weight: bold;"/>
                                                </children>
                                            </VBox>

                                            <VBox alignment="CENTER" spacing="5.0" style="-fx-background-color: #e74c3c; -fx-background-radius: 10; -fx-padding: 15;" GridPane.columnIndex="1">
                                                <children>
                                                    <Label text="ðŸŽ“" style="-fx-font-size: 24;"/>
                                                    <Label text="Total Profesores" style="-fx-text-fill: white; -fx-font-weight: bold;"/>
                                                    <Label fx:id="lblTotalProfesores" text="0" style="-fx-text-fill: white; -fx-font-size: 18; -fx-font-weight: bold;"/>
                                                </children>
                                            </VBox>

                                            <VBox alignment="CENTER" spacing="5.0" style="-fx-background-color: #f39c12; -fx-background-radius: 10; -fx-padding: 15;" GridPane.columnIndex="2">
                                                <children>
                                                    <Label text="ðŸ“š" style="-fx-font-size: 24;"/>
                                                    <Label text="Total Cursos" style="-fx-text-fill: white; -fx-font-weight: bold;"/>
                                                    <Label fx:id="lblTotalCursos" text="0" style="-fx-text-fill: white; -fx-font-size: 18; -fx-font-weight: bold;"/>
                                                </children>
                                            </VBox>

                                            <VBox alignment="CENTER" spacing="5.0" style="-fx-background-color: #9b59b6; -fx-background-radius: 10; -fx-padding: 15;" GridPane.columnIndex="3">
                                                <children>
                                                    <Label text="â­" style="-fx-font-size: 24;"/>
                                                    <Label text="Promedio Calificaciones" style="-fx-text-fill: white; -fx-font-weight: bold;"/>
                                                    <Label fx:id="lblPromedioCalificaciones" text="0.0" style="-fx-text-fill: white; -fx-font-size: 18; -fx-font-weight: bold;"/>
                                                </children>
                                            </VBox>

                                            <!-- Fila 2 -->
                                            <VBox alignment="CENTER" spacing="5.0" style="-fx-background-color: #2ecc71; -fx-background-radius: 10; -fx-padding: 15;" GridPane.rowIndex="1">
                                                <children>
                                                    <Label text="âœ…" style="-fx-font-size: 24;"/>
                                                    <Label text="Tasa AprobaciÃ³n" style="-fx-text-fill: white; -fx-font-weight: bold;"/>
                                                    <Label fx:id="lblTasaAprobacion" text="0%" style="-fx-text-fill: white; -fx-font-size: 18; -fx-font-weight: bold;"/>
                                                </children>
                                            </VBox>

                                            <VBox alignment="CENTER" spacing="5.0" style="-fx-background-color: #1abc9c; -fx-background-radius: 10; -fx-padding: 15;" GridPane.rowIndex="1" GridPane.columnIndex="1">
                                                <children>
                                                    <Label text="ðŸ“…" style="-fx-font-size: 24;"/>
                                                    <Label text="Tasa Asistencia" style="-fx-text-fill: white; -fx-font-weight: bold;"/>
                                                    <Label fx:id="lblTasaAsistencia" text="0%" style="-fx-text-fill: white; -fx-font-size: 18; -fx-font-weight: bold;"/>
                                                </children>
                                            </VBox>
                                        </children>
                                    </GridPane>
                                </VBox>

                                <!-- GrÃ¡ficos EstadÃ­sticos -->
                                <Label text="ðŸ“Š VisualizaciÃ³n de Datos" styleClass="section-subtitle">
                                    <VBox.margin>
                                        <Insets left="20.0" />
                                    </VBox.margin>
                                </Label>

                                <HBox spacing="20.0" VBox.vgrow="ALWAYS">
                                    <VBox.margin>
                                        <Insets left="20.0" right="20.0" bottom="20.0" />
                                    </VBox.margin>

                                    <!-- GrÃ¡fico de Torta - DistribuciÃ³n por Nivel -->
                                    <VBox spacing="10.0" HBox.hgrow="ALWAYS">
                                        <Label text="ðŸŽ¯ DistribuciÃ³n por Nivel" style="-fx-font-weight: bold;"/>
                                        <PieChart fx:id="pieChartNiveles" HBox.hgrow="ALWAYS" prefHeight="300"/>
                                    </VBox>

                                    <!-- GrÃ¡fico de Barras - Instrumentos -->
                                    <VBox spacing="10.0" HBox.hgrow="ALWAYS">
                                        <Label text="ðŸŽµ Estudiantes por Instrumento" style="-fx-font-weight: bold;"/>
                                        <BarChart fx:id="barChartInstrumentos" HBox.hgrow="ALWAYS" prefHeight="300">
                                            <xAxis>
                                                <CategoryAxis label="Instrumentos" />
                                            </xAxis>
                                            <yAxis>
                                                <NumberAxis label="Cantidad" />
                                            </yAxis>
                                        </BarChart>
                                    </VBox>
                                </HBox>

                                <!-- GrÃ¡fico de LÃ­nea - Progreso -->
                                <VBox spacing="10.0" prefHeight="300">
                                    <VBox.margin>
                                        <Insets left="20.0" right="20.0" bottom="20.0" />
                                    </VBox.margin>
                                    <Label text="ðŸ“ˆ EvoluciÃ³n del Progreso" style="-fx-font-weight: bold;"/>
                                    <LineChart fx:id="lineChartProgreso" VBox.vgrow="ALWAYS">
                                        <xAxis>
                                            <CategoryAxis label="Meses" />
                                        </xAxis>
                                        <yAxis>
                                            <NumberAxis label="CalificaciÃ³n Promedio" />
                                        </yAxis>
                                    </LineChart>
                                </VBox>
                            </VBox>
                        </content>
                    </Tab>

                    <!-- PESTAÃ‘A 3: REPORTES PERSONALIZADOS -->
                    <Tab text="ðŸ”§ Reportes Personalizados">
                        <content>
                            <VBox styleClass="content-area" spacing="20.0">
                                <VBox.margin>
                                    <Insets top="20.0" />
                                </VBox.margin>

                                <Label text="Consultas y Reportes Personalizados" styleClass="section-title">
                                    <VBox.margin>
                                        <Insets left="20.0" />
                                    </VBox.margin>
                                </Label>

                                <!-- Editor de Consultas -->
                                <VBox styleClass="form-container" spacing="15.0">
                                    <VBox.margin>
                                        <Insets left="20.0" right="20.0" />
                                    </VBox.margin>

                                    <Label text="ðŸ“ Editor de Consultas" style="-fx-font-weight: bold; -fx-font-size: 16;"/>

                                    <Label text="Consulta Personalizada:" styleClass="form-label"/>
                                    <TextArea fx:id="txtConsultaPersonalizada" promptText="Escriba su consulta personalizada aquÃ­..."
                                              styleClass="form-field" prefHeight="150"/>

                                    <HBox alignment="CENTER" spacing="15.0">
                                        <Button fx:id="btnEjecutarConsulta" mnemonicParsing="false" onAction="#onEjecutarConsulta"
                                                text="âš¡ Ejecutar Consulta" styleClass="primary-button"/>
                                    </HBox>
                                </VBox>

                                <!-- Resultados Personalizados -->
                                <Label text="ðŸ“‹ Resultados de la Consulta" styleClass="section-subtitle">
                                    <VBox.margin>
                                        <Insets left="20.0" />
                                    </VBox.margin>
                                </Label>

                                <TableView fx:id="tblResultadosPersonalizados" VBox.vgrow="ALWAYS">
                                    <VBox.margin>
                                        <Insets bottom="20.0" left="20.0" right="20.0" top="10.0" />
                                    </VBox.margin>
                                    <!-- Las columnas se crearÃ¡n dinÃ¡micamente segÃºn la consulta -->
                                </TableView>
                            </VBox>
                        </content>
                    </Tab>
                </tabs>
            </TabPane>
        </VBox>
    </children>
</AnchorPane>