<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.*?>
<?import javafx.scene.chart.PieChart?>
<?import javafx.scene.chart.BarChart?>
<?import javafx.scene.chart.LineChart?>
<?import javafx.scene.chart.CategoryAxis?>
<?import javafx.scene.chart.NumberAxis?>

<AnchorPane prefHeight="700.0" prefWidth="900.0" minHeight="600.0" minWidth="800.0" styleClass="dashboard-container"
            xmlns="http://javafx.com/javafx/8"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="co.edu.uniquindio.poo.academiamusicuq.viewController.ReportesViewController">

    <children>
        <VBox prefHeight="700.0" prefWidth="900.0" minHeight="600.0" minWidth="800.0"
              AnchorPane.bottomAnchor="0.0" AnchorPane.leftAnchor="0.0" AnchorPane.rightAnchor="0.0" AnchorPane.topAnchor="0.0"
              spacing="0">

            <!-- Header -->
            <HBox alignment="CENTER_LEFT" style="-fx-background-color: #2980b9;" VBox.vgrow="NEVER" prefHeight="55.0">
                <padding>
                    <Insets left="20.0" right="20.0" />
                </padding>
                <children>
                    <Button fx:id="btnVolver" mnemonicParsing="false" onAction="#onVolver" text="â¬… Volver al MenÃº"
                            styleClass="secondary-button" prefWidth="120.0" prefHeight="35.0">
                        <HBox.margin>
                            <Insets right="20.0" />
                        </HBox.margin>
                    </Button>
                    <Label text="ðŸ“Š MÃ³dulo de Reportes Avanzados" style="-fx-text-fill: white; -fx-font-size: 18; -fx-font-weight: bold;"/>
                </children>
            </HBox>

            <!-- Contenido principal con pestaÃ±as -->
            <TabPane fx:id="tabPaneReportes" tabClosingPolicy="UNAVAILABLE" VBox.vgrow="ALWAYS">
                <tabs>
                    <!-- PESTAÃ‘A 1: REPORTES AVANZADOS -->
                    <Tab text="ðŸ“ˆ Reportes Avanzados">
                        <content>
                            <VBox styleClass="content-area" spacing="15.0" VBox.vgrow="ALWAYS">
                                <padding>
                                    <Insets top="20.0" bottom="20.0" left="15.0" right="15.0" />
                                </padding>

                                <Label text="GeneraciÃ³n de Reportes Avanzados" styleClass="section-title" style="-fx-font-size: 16;">
                                    <padding>
                                        <Insets left="5.0" bottom="15.0" />
                                    </padding>
                                </Label>

                                <!-- Filtros Avanzados Mejorados -->
                                <VBox styleClass="form-container" spacing="15.0" VBox.vgrow="NEVER">
                                    <padding>
                                        <Insets left="10.0" right="10.0" />
                                    </padding>

                                    <Label text="ðŸ” Filtros del Reporte" style="-fx-font-weight: bold; -fx-font-size: 14;"/>

                                    <GridPane hgap="12.0" vgap="12.0" VBox.vgrow="NEVER">
                                        <columnConstraints>
                                            <ColumnConstraints hgrow="SOMETIMES" minWidth="100.0" prefWidth="120.0" />
                                            <ColumnConstraints hgrow="SOMETIMES" minWidth="150.0" prefWidth="180.0" />
                                            <ColumnConstraints hgrow="SOMETIMES" minWidth="100.0" prefWidth="120.0" />
                                            <ColumnConstraints hgrow="SOMETIMES" minWidth="150.0" prefWidth="180.0" />
                                        </columnConstraints>
                                        <rowConstraints>
                                            <RowConstraints minHeight="35.0" prefHeight="35.0" vgrow="SOMETIMES" />
                                            <RowConstraints minHeight="35.0" prefHeight="35.0" vgrow="SOMETIMES" />
                                        </rowConstraints>
                                        <children>
                                            <!-- Fila 1 -->
                                            <Label text="Tipo Reporte:" styleClass="form-label" GridPane.rowIndex="0" GridPane.columnIndex="0"/>
                                            <ComboBox fx:id="cbTipoReporteAvanzado" styleClass="form-field" prefHeight="35" GridPane.rowIndex="0" GridPane.columnIndex="1"/>

                                            <Label text="Estudiante:" styleClass="form-label" GridPane.rowIndex="0" GridPane.columnIndex="2"/>
                                            <ComboBox fx:id="cbEstudianteReporte" styleClass="form-field" prefHeight="35" GridPane.rowIndex="0" GridPane.columnIndex="3"/>

                                            <!-- Fila 2 -->
                                            <Label text="Curso:" styleClass="form-label" GridPane.rowIndex="1" GridPane.columnIndex="0"/>
                                            <ComboBox fx:id="cbCursoReporte" styleClass="form-field" prefHeight="35" GridPane.rowIndex="1" GridPane.columnIndex="1"/>

                                            <Label text="Profesor:" styleClass="form-label" GridPane.rowIndex="1" GridPane.columnIndex="2"/>
                                            <ComboBox fx:id="cbProfesorReporte" styleClass="form-field" prefHeight="35" GridPane.rowIndex="1" GridPane.columnIndex="3"/>
                                        </children>
                                    </GridPane>

                                    <!-- Fechas y Botones en misma lÃ­nea -->
                                    <HBox alignment="CENTER_LEFT" spacing="15.0" VBox.vgrow="NEVER">
                                        <padding>
                                            <Insets top="10.0" />
                                        </padding>
                                        <children>
                                            <Label text="Fecha Inicio:" styleClass="form-label"/>
                                            <DatePicker fx:id="dpFechaInicioReporte" styleClass="form-field" prefWidth="140" prefHeight="35"/>

                                            <Label text="Fecha Fin:" styleClass="form-label"/>
                                            <DatePicker fx:id="dpFechaFinReporte" styleClass="form-field" prefWidth="140" prefHeight="35"/>

                                            <Button fx:id="btnGenerarReporte" mnemonicParsing="false" onAction="#onGenerarReporte"
                                                    text="ðŸš€ Generar Reporte" styleClass="primary-button" prefWidth="140" prefHeight="35"/>
                                        </children>
                                    </HBox>

                                    <!-- Botones de ExportaciÃ³n -->
                                    <HBox alignment="CENTER" spacing="15.0" VBox.vgrow="NEVER">
                                        <padding>
                                            <Insets top="10.0" />
                                        </padding>
                                        <children>
                                            <Button fx:id="btnExportarPDF" mnemonicParsing="false" onAction="#onExportarPDF"
                                                    text="ðŸ“„ Exportar PDF" styleClass="secondary-button" prefWidth="130" prefHeight="35"/>
                                            <Button fx:id="btnExportarExcel" mnemonicParsing="false" onAction="#onExportarExcel"
                                                    text="ðŸ“Š Exportar Excel" styleClass="secondary-button" prefWidth="130" prefHeight="35"/>
                                        </children>
                                    </HBox>
                                </VBox>

                                <!-- Tabla de Resultados Completa -->
                                <VBox spacing="10.0" VBox.vgrow="ALWAYS">
                                    <padding>
                                        <Insets left="10.0" right="10.0" top="15.0" />
                                    </padding>
                                    <children>
                                        <Label text="ðŸ“‹ Resultados del Reporte" styleClass="section-subtitle" style="-fx-font-size: 14;"/>
                                        <TabPane tabClosingPolicy="UNAVAILABLE" VBox.vgrow="ALWAYS" prefHeight="300.0">
                                            <tabs>
                                                <Tab text="ðŸ“ˆ Reportes de Progreso">
                                                    <content>
                                                        <TableView fx:id="tblReportesProgreso" VBox.vgrow="ALWAYS">
                                                            <columns>
                                                                <TableColumn fx:id="colIdReporte" prefWidth="80.0" minWidth="70.0" text="ID" />
                                                                <TableColumn fx:id="colEstudiante" prefWidth="150.0" minWidth="130.0" text="Estudiante" />
                                                                <TableColumn fx:id="colCurso" prefWidth="150.0" minWidth="130.0" text="Curso" />
                                                                <TableColumn fx:id="colProfesor" prefWidth="140.0" minWidth="120.0" text="Profesor" />
                                                                <TableColumn fx:id="colCalificacion" prefWidth="100.0" minWidth="90.0" text="CalificaciÃ³n" />
                                                                <TableColumn fx:id="colAprobado" prefWidth="100.0" minWidth="90.0" text="Aprobado" />
                                                                <TableColumn fx:id="colFecha" prefWidth="120.0" minWidth="110.0" text="Fecha" />
                                                            </columns>
                                                        </TableView>
                                                    </content>
                                                </Tab>
                                                <Tab text="âœ… Asistencias">
                                                    <content>
                                                        <TableView fx:id="tblReportesAsistencia" VBox.vgrow="ALWAYS">
                                                            <columns>
                                                                <TableColumn fx:id="colIdAsistencia" prefWidth="80.0" minWidth="70.0" text="ID" />
                                                                <TableColumn fx:id="colEstudianteAsistencia" prefWidth="150.0" minWidth="130.0" text="Estudiante" />
                                                                <TableColumn fx:id="colClaseAsistencia" prefWidth="150.0" minWidth="130.0" text="Clase" />
                                                                <TableColumn fx:id="colFechaAsistencia" prefWidth="120.0" minWidth="110.0" text="Fecha" />
                                                                <TableColumn fx:id="colPresente" prefWidth="100.0" minWidth="90.0" text="Presente" />
                                                            </columns>
                                                        </TableView>
                                                    </content>
                                                </Tab>
                                                <Tab text="ðŸ“‹ MatrÃ­culas">
                                                    <content>
                                                        <TableView fx:id="tblReportesMatriculas" VBox.vgrow="ALWAYS">
                                                            <columns>
                                                                <TableColumn fx:id="colIdMatricula" prefWidth="80.0" minWidth="70.0" text="ID" />
                                                                <TableColumn fx:id="colEstudianteMatricula" prefWidth="150.0" minWidth="130.0" text="Estudiante" />
                                                                <TableColumn fx:id="colCursoMatricula" prefWidth="150.0" minWidth="130.0" text="Curso" />
                                                                <TableColumn fx:id="colEstadoMatricula" prefWidth="120.0" minWidth="110.0" text="Estado" />
                                                                <TableColumn fx:id="colFechaMatricula" prefWidth="120.0" minWidth="110.0" text="Fecha" />
                                                            </columns>
                                                        </TableView>
                                                    </content>
                                                </Tab>
                                            </tabs>
                                        </TabPane>
                                    </children>
                                </VBox>
                            </VBox>
                        </content>
                    </Tab>

                    <!-- PESTAÃ‘A 2: ESTADÃSTICAS DETALLADAS -->
                    <Tab text="ðŸ“Š EstadÃ­sticas Detalladas">
                        <content>
                            <VBox styleClass="content-area" spacing="15.0" VBox.vgrow="ALWAYS">
                                <padding>
                                    <Insets top="20.0" bottom="20.0" left="15.0" right="15.0" />
                                </padding>

                                <Label text="EstadÃ­sticas y MÃ©tricas del Sistema" styleClass="section-title" style="-fx-font-size: 16;">
                                    <padding>
                                        <Insets left="5.0" bottom="15.0" />
                                    </padding>
                                </Label>

                                <!-- MÃ©tricas Principales Completas -->
                                <VBox styleClass="form-container" spacing="15.0" VBox.vgrow="NEVER">
                                    <padding>
                                        <Insets left="10.0" right="10.0" />
                                    </padding>

                                    <Label text="ðŸ“ˆ MÃ©tricas Principales" style="-fx-font-weight: bold; -fx-font-size: 14;"/>

                                    <GridPane hgap="15.0" vgap="15.0" VBox.vgrow="NEVER">
                                        <columnConstraints>
                                            <ColumnConstraints hgrow="SOMETIMES" minWidth="160.0" prefWidth="180.0" />
                                            <ColumnConstraints hgrow="SOMETIMES" minWidth="160.0" prefWidth="180.0" />
                                            <ColumnConstraints hgrow="SOMETIMES" minWidth="160.0" prefWidth="180.0" />
                                            <ColumnConstraints hgrow="SOMETIMES" minWidth="160.0" prefWidth="180.0" />
                                        </columnConstraints>
                                        <rowConstraints>
                                            <RowConstraints minHeight="80.0" prefHeight="90.0" vgrow="SOMETIMES" />
                                            <RowConstraints minHeight="80.0" prefHeight="90.0" vgrow="SOMETIMES" />
                                        </rowConstraints>
                                        <children>
                                            <!-- Fila 1 -->
                                            <VBox alignment="CENTER" spacing="5.0" style="-fx-background-color: #3498db; -fx-background-radius: 10; -fx-padding: 15;">
                                                <children>
                                                    <Label text="ðŸ‘¥" style="-fx-font-size: 20;"/>
                                                    <Label text="Total Estudiantes" style="-fx-text-fill: white; -fx-font-weight: bold; -fx-font-size: 12;"/>
                                                    <Label fx:id="lblTotalEstudiantes" text="0" style="-fx-text-fill: white; -fx-font-size: 16; -fx-font-weight: bold;"/>
                                                </children>
                                            </VBox>

                                            <VBox alignment="CENTER" spacing="5.0" style="-fx-background-color: #e74c3c; -fx-background-radius: 10; -fx-padding: 15;" GridPane.columnIndex="1">
                                                <children>
                                                    <Label text="ðŸŽ“" style="-fx-font-size: 20;"/>
                                                    <Label text="Total Profesores" style="-fx-text-fill: white; -fx-font-weight: bold; -fx-font-size: 12;"/>
                                                    <Label fx:id="lblTotalProfesores" text="0" style="-fx-text-fill: white; -fx-font-size: 16; -fx-font-weight: bold;"/>
                                                </children>
                                            </VBox>

                                            <VBox alignment="CENTER" spacing="5.0" style="-fx-background-color: #f39c12; -fx-background-radius: 10; -fx-padding: 15;" GridPane.columnIndex="2">
                                                <children>
                                                    <Label text="ðŸ“š" style="-fx-font-size: 20;"/>
                                                    <Label text="Total Cursos" style="-fx-text-fill: white; -fx-font-weight: bold; -fx-font-size: 12;"/>
                                                    <Label fx:id="lblTotalCursos" text="0" style="-fx-text-fill: white; -fx-font-size: 16; -fx-font-weight: bold;"/>
                                                </children>
                                            </VBox>

                                            <VBox alignment="CENTER" spacing="5.0" style="-fx-background-color: #9b59b6; -fx-background-radius: 10; -fx-padding: 15;" GridPane.columnIndex="3">
                                                <children>
                                                    <Label text="â­" style="-fx-font-size: 20;"/>
                                                    <Label text="Promedio Calificaciones" style="-fx-text-fill: white; -fx-font-weight: bold; -fx-font-size: 12;"/>
                                                    <Label fx:id="lblPromedioCalificaciones" text="0.0" style="-fx-text-fill: white; -fx-font-size: 16; -fx-font-weight: bold;"/>
                                                </children>
                                            </VBox>

                                            <!-- Fila 2 -->
                                            <VBox alignment="CENTER" spacing="5.0" style="-fx-background-color: #2ecc71; -fx-background-radius: 10; -fx-padding: 15;" GridPane.rowIndex="1">
                                                <children>
                                                    <Label text="âœ…" style="-fx-font-size: 20;"/>
                                                    <Label text="Tasa AprobaciÃ³n" style="-fx-text-fill: white; -fx-font-weight: bold; -fx-font-size: 12;"/>
                                                    <Label fx:id="lblTasaAprobacion" text="0%" style="-fx-text-fill: white; -fx-font-size: 16; -fx-font-weight: bold;"/>
                                                </children>
                                            </VBox>

                                            <VBox alignment="CENTER" spacing="5.0" style="-fx-background-color: #1abc9c; -fx-background-radius: 10; -fx-padding: 15;" GridPane.rowIndex="1" GridPane.columnIndex="1">
                                                <children>
                                                    <Label text="ðŸ“…" style="-fx-font-size: 20;"/>
                                                    <Label text="Tasa Asistencia" style="-fx-text-fill: white; -fx-font-weight: bold; -fx-font-size: 12;"/>
                                                    <Label fx:id="lblTasaAsistencia" text="0%" style="-fx-text-fill: white; -fx-font-size: 16; -fx-font-weight: bold;"/>
                                                </children>
                                            </VBox>

                                            <!-- Espacio para futuras mÃ©tricas -->
                                            <VBox alignment="CENTER" spacing="5.0" style="-fx-background-color: #34495e; -fx-background-radius: 10; -fx-padding: 15;" GridPane.rowIndex="1" GridPane.columnIndex="2" GridPane.columnSpan="2">
                                                <children>
                                                    <Label text="ðŸ“Š" style="-fx-font-size: 20;"/>
                                                    <Label text="MÃ©tricas Adicionales" style="-fx-text-fill: white; -fx-font-weight: bold; -fx-font-size: 12;"/>
                                                    <Label text="Disponibles" style="-fx-text-fill: white; -fx-font-size: 14; -fx-font-weight: bold;"/>
                                                </children>
                                            </VBox>
                                        </children>
                                    </GridPane>
                                </VBox>

                                <!-- GrÃ¡ficos EstadÃ­sticos Completos -->
                                <VBox spacing="15.0" VBox.vgrow="ALWAYS">
                                    <padding>
                                        <Insets left="10.0" right="10.0" top="15.0" />
                                    </padding>
                                    <children>
                                        <Label text="ðŸ“Š VisualizaciÃ³n de Datos" styleClass="section-subtitle" style="-fx-font-size: 14;"/>

                                        <!-- GrÃ¡ficos en diseÃ±o vertical para mejor visualizaciÃ³n -->
                                        <VBox spacing="15.0" VBox.vgrow="ALWAYS">
                                            <HBox spacing="15.0" VBox.vgrow="ALWAYS">
                                                <VBox spacing="8.0" HBox.hgrow="ALWAYS" prefHeight="250">
                                                    <Label text="ðŸŽ¯ DistribuciÃ³n por Nivel" style="-fx-font-weight: bold; -fx-font-size: 12;"/>
                                                    <PieChart fx:id="pieChartNiveles" HBox.hgrow="ALWAYS" prefHeight="220"/>
                                                </VBox>

                                                <VBox spacing="8.0" HBox.hgrow="ALWAYS" prefHeight="250">
                                                    <Label text="ðŸŽµ Estudiantes por Instrumento" style="-fx-font-weight: bold; -fx-font-size: 12;"/>
                                                    <BarChart fx:id="barChartInstrumentos" HBox.hgrow="ALWAYS" prefHeight="220">
                                                        <xAxis>
                                                            <CategoryAxis label="Instrumentos" />
                                                        </xAxis>
                                                        <yAxis>
                                                            <NumberAxis label="Cantidad" />
                                                        </yAxis>
                                                    </BarChart>
                                                </VBox>
                                            </HBox>

                                            <VBox spacing="8.0" VBox.vgrow="ALWAYS" prefHeight="250">
                                                <Label text="ðŸ“ˆ EvoluciÃ³n del Progreso" style="-fx-font-weight: bold; -fx-font-size: 12;"/>
                                                <LineChart fx:id="lineChartProgreso" VBox.vgrow="ALWAYS" prefHeight="220">
                                                    <xAxis>
                                                        <CategoryAxis label="Meses" />
                                                    </xAxis>
                                                    <yAxis>
                                                        <NumberAxis label="CalificaciÃ³n Promedio" />
                                                    </yAxis>
                                                </LineChart>
                                            </VBox>
                                        </VBox>
                                    </children>
                                </VBox>
                            </VBox>
                        </content>
                    </Tab>

                    <!-- PESTAÃ‘A 3: REPORTES PERSONALIZADOS -->
                    <Tab text="ðŸ”§ Reportes Personalizados">
                        <content>
                            <VBox styleClass="content-area" spacing="15.0" VBox.vgrow="ALWAYS">
                                <padding>
                                    <Insets top="20.0" bottom="20.0" left="15.0" right="15.0" />
                                </padding>

                                <Label text="Consultas y Reportes Personalizados" styleClass="section-title" style="-fx-font-size: 16;">
                                    <padding>
                                        <Insets left="5.0" bottom="15.0" />
                                    </padding>
                                </Label>

                                <!-- Editor de Consultas Completo -->
                                <VBox styleClass="form-container" spacing="15.0" VBox.vgrow="ALWAYS">
                                    <padding>
                                        <Insets left="10.0" right="10.0" />
                                    </padding>

                                    <Label text="ðŸ“ Editor de Consultas Personalizadas" style="-fx-font-weight: bold; -fx-font-size: 14;"/>

                                    <Label text="Escriba su consulta SQL personalizada:" styleClass="form-label"/>
                                    <TextArea fx:id="txtConsultaPersonalizada"
                                              promptText="Ejemplo: SELECT * FROM estudiantes WHERE nivel = 'Avanzado'"
                                              styleClass="form-field" prefHeight="150" VBox.vgrow="ALWAYS"/>

                                    <HBox alignment="CENTER" spacing="15.0" VBox.vgrow="NEVER">
                                        <padding>
                                            <Insets top="10.0" />
                                        </padding>
                                        <children>
                                            <Button fx:id="btnEjecutarConsulta" mnemonicParsing="false" onAction="#onEjecutarConsulta"
                                                    text="âš¡ Ejecutar Consulta" styleClass="primary-button" prefWidth="150" prefHeight="35"/>
                                        </children>
                                    </HBox>
                                </VBox>

                                <!-- Resultados Personalizados Completos -->
                                <VBox spacing="10.0" VBox.vgrow="ALWAYS">
                                    <padding>
                                        <Insets left="10.0" right="10.0" top="15.0" />
                                    </padding>
                                    <children>
                                        <Label text="ðŸ“‹ Resultados de la Consulta Personalizada" styleClass="section-subtitle" style="-fx-font-size: 14;"/>
                                        <TableView fx:id="tblResultadosPersonalizados" VBox.vgrow="ALWAYS" prefHeight="300.0">
                                            <!-- Las columnas se crearÃ¡n dinÃ¡micamente segÃºn la consulta -->
                                        </TableView>
                                    </children>
                                </VBox>
                            </VBox>
                        </content>
                    </Tab>
                </tabs>
            </TabPane>
        </VBox>
    </children>
</AnchorPane>